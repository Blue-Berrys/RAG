.PHONY: help build run test clean deps docker-up docker-down import-data demo

help:  ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@echo "CookRAG-Go å¼€å‘å‘½ä»¤"
	@echo ""
	@echo "ä½¿ç”¨æ–¹æ³•:"
	@echo "  make [å‘½ä»¤]"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

deps:  ## ä¸‹è½½ä¾èµ–
	@echo "ğŸ“¦ ä¸‹è½½Goä¾èµ–..."
	go mod download
	@echo "âœ… ä¾èµ–ä¸‹è½½å®Œæˆ"

build:  ## ç¼–è¯‘é¡¹ç›®
	@echo "ğŸ”¨ ç¼–è¯‘é¡¹ç›®..."
	go build -o cookrag-server cmd/server/main.go
	@echo "âœ… ç¼–è¯‘å®Œæˆ: ./cookrag-server"

run:  ## è¿è¡Œä¸»ç¨‹åº
	@echo "ğŸš€ è¿è¡ŒCookRAG-GoæœåŠ¡å™¨..."
	go run cmd/server/main.go

test:  ## è¿è¡Œæµ‹è¯•
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	go test -v ./...

test-coverage:  ## è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•ï¼ˆè¦†ç›–ç‡ï¼‰..."
	go test -race -coverprofile=coverage.out ./...
	go tool cover -html=coverage.out -o coverage.html
	@echo "âœ… è¦†ç›–ç‡æŠ¥å‘Š: coverage.html"

lint:  ## ä»£ç æ£€æŸ¥
	@echo "ğŸ” ä»£ç æ£€æŸ¥..."
	golangci-lint run

fmt:  ## æ ¼å¼åŒ–ä»£ç 
	@echo "ğŸ’… æ ¼å¼åŒ–ä»£ç ..."
	goimports -w .
	go fmt ./...

clean:  ## æ¸…ç†ç¼–è¯‘æ–‡ä»¶
	@echo "ğŸ§¹ æ¸…ç†ç¼–è¯‘æ–‡ä»¶..."
	rm -f cookrag-server
	rm -f coverage.out coverage.html
	@echo "âœ… æ¸…ç†å®Œæˆ"

docker-up:  ## å¯åŠ¨DockeræœåŠ¡
	@echo "ğŸ³ å¯åŠ¨DockeræœåŠ¡..."
	docker-compose up -d
	@echo "âœ… DockeræœåŠ¡å·²å¯åŠ¨"

docker-down:  ## åœæ­¢DockeræœåŠ¡
	@echo "ğŸ³ åœæ­¢DockeræœåŠ¡..."
	docker-compose down
	@echo "âœ… DockeræœåŠ¡å·²åœæ­¢"

docker-logs:  ## æŸ¥çœ‹Dockeræ—¥å¿—
	docker-compose logs -f

init: deps docker-up  ## åˆå§‹åŒ–é¡¹ç›®ï¼ˆä¸‹è½½ä¾èµ–+å¯åŠ¨Dockerï¼‰

import-data:  ## å¯¼å…¥ç¤ºä¾‹æ•°æ®
	@echo "ğŸ“š å¯¼å…¥ç¤ºä¾‹æ•°æ®..."
	go run cmd/import/main.go
	@echo "âœ… æ•°æ®å¯¼å…¥å®Œæˆ"

demo:  ## è¿è¡Œå®Œæ•´æ¼”ç¤º
	@echo "ğŸ® è¿è¡Œå®Œæ•´æ¼”ç¤º..."
	go run cmd/demo/main.go
	@echo "âœ… æ¼”ç¤ºå®Œæˆ"

all: fmt lint test build  ## æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥å¹¶ç¼–è¯‘
